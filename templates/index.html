{% extends "layout.html" %}

{% block content %}
<style>
    html {
        scroll-behavior: smooth;
    }

    /* éšè—æ»šåŠ¨æ¡ */
    body, html {
        overflow: hidden;
    }

    /* ä½¿ç”¨ -webkit- ä¼ªå…ƒç´ æ¥éšè—æ»šåŠ¨æ¡ */
    ::-webkit-scrollbar {
        display: none;
    }

    /* å‘ä¸‹æ»šåŠ¨æç¤ºçš„æ ·å¼ */
    .scroll-hint {
        position: absolute;
        bottom: 2rem; /* è°ƒæ•´é«˜åº¦ */
        left: 50%;
        transform: translateX(-50%);
        font-size: 1.125rem;
    }

    /* æ¸å˜èƒŒæ™¯è‰² */
    .bg-gradient {
        background: linear-gradient(to bottom, #E9C0BE, #E67B75);
    }

    /* èƒŒæ™¯å›¾æ ·å¼ */
    .bg-image {
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-image: url("https://pic1.imgdb.cn/item/67b091e1d0e0a243d4ffaa0d.webp");
    }

    /* æç¤ºæ–‡æœ¬é»˜è®¤éšè— */
    .scroll-hint-text {
        display: none;
    }

    /* ç§»åŠ¨ç«¯èƒŒæ™¯å›¾ä½ç½®è°ƒæ•´ */
    @media (max-width: 768px) {
        .bg-image {
            background-position: 70%;
        }
        .scroll-hint-text {
            display: block;
        }
    }

    .text-indent {
        text-indent: 2em; /* ç¼©è¿›ä¸¤ä¸ªå­—ç¬¦ */
    }

    /* å­é¢‘é“éƒ¨åˆ†å·¦å³æ»‘åŠ¨ */
    .scroll-container {
        display: flex;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scroll-snap-type: x mandatory;
    }

    .scroll-item {
        flex: 0 0 auto;
        scroll-snap-align: start;
        margin-right: 1rem; /* è°ƒæ•´é—´è· */
    }
    html {
        transition: all 0.3s ease;
    }
</style>

<!-- æ•´ä¸ªé¡µé¢ä½¿ç”¨æ»šåŠ¨å¯¹é½ -->
<div class="snap-y snap-mandatory overflow-y-scroll h-screen" id="main-container">

    <!-- é¦–é¡µå±•ç¤ºéƒ¨åˆ† -->
    <section class="h-screen bg-gradient flex flex-col justify-center items-center text-center text-white snap-start relative bg-image">
        <div class="text-shadow">
            <h1 class="text-6xl font-bold">æ²ƒç›é¢‘é“</h1>
            <p class="text-xl mt-4">ä¸€ä¸ªéå®˜æ–¹çš„<a href="https://space.bilibili.com/53456" target="_blank" class="font-bold"> @Warma </a>åŒäººäº¤æµç¤¾åŒº</p>
        </div>
        <!-- æŒ‰é’®éƒ¨åˆ† -->
        <div class="mt-8 flex space-x-4 text-shadow">
            <a href="https://qm.qq.com/q/aTXFsufyeI" target="_blank" class="bg-[#1C7DF2] hover:bg-[#73A7E6] text-[#DDF1E8] font-bold py-2 px-4 rounded flex items-center">
                <i class="fa fa-qq mr-2"></i>
                åŠ å…¥Qç¾¤
            </a>
            <a href="https://pd.qq.com/g/WarmaFans1026/" target="_blank" class="bg-[#1CF193] hover:bg-[#9BE6C5] text-[#BEE9D6] font-bold py-2 px-4 rounded flex items-center">
                <i class="fa fa-hashtag mr-2"></i>
                åŠ å…¥é¢‘é“
            </a>
        </div>
        <!-- å‘ä¸‹æ»šåŠ¨æç¤º -->
        <div class="scroll-hint text-[#3B1426]">
            <span>å‘ä¸‹æ»šåŠ¨æŸ¥çœ‹æ›´å¤š</span>
        </div>
    </section>

    <!-- æ²ƒç›é¢‘é“ä»‹ç»å’Œå­é¢‘é“éƒ¨åˆ† -->
    <section class="h-screen bg-[#E9BED0] text-white snap-start flex flex-col items-center justify-center px-4">
        <div class="max-w-4xl mx-auto">
            <div class="bg-[#F1DDE6] rounded-lg shadow-lg p-6 mt-8">
                <h3 class="text-2xl font-semibold mb-4 text-[#5E1938]">å…³äºæˆ‘ä»¬</h3>
                <p class="text-lg leading-relaxed text-[#5E1938] text-indent">
                    æ²ƒç›é¢‘é“æ˜¯ç”±æ²ƒç›ç²‰ä¸å…±åŒç»´æŠ¤çš„éå®˜æ–¹ç»¼åˆç¤¾åŒºï¼Œè¿™é‡Œæœ‰è¶…è¿‡<span class="text-[#AC1558] font-bold">20ä¸ªå…´è¶£å­é¢‘é“</span>ï¼Œèšé›†äº†<span class="text-[#AC1558] font-bold">1.5ä¸‡+</span>å¿—åŒé“åˆçš„ä¼™ä¼´ã€‚æˆ‘ä»¬è‡´åŠ›äºæ‰“é€ ä¸€ä¸ªæ¸©æš–ã€åŒ…å®¹çš„äº¤æµç©ºé—´ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥ï¼š
                </p>
                <ul class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6 text-center text-[#5E1938]">
                    <li class="flex items-center justify-center">â¤åˆ†äº«å¯¹æ²ƒç›çš„å–œçˆ±</li>
                    <li class="flex items-center justify-center">â­äº¤æµå…´è¶£çˆ±å¥½</li>
                    <li class="flex items-center justify-center">ğŸ‰åˆ†äº«æ—¥å¸¸ç”Ÿæ´»</li>
                    <li class="flex items-center justify-center">ğŸ¨å±•ç¤ºåŒäººåˆ›ä½œ</li>
                    <li class="flex items-center justify-center">ğŸ®ç»„é˜Ÿæ¸¸æˆå¼€é»‘</li>
                    <li class="flex items-center justify-center">ğŸ¤ç»“è¯†æœ‰è¶£ä¼™ä¼´</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- è¯¦ç»†ä»‹ç» -->
    <section class="h-screen bg-[#E6B374] text-[#3B2B14] snap-start flex flex-col items-center justify-center px-4">
        <div class="max-w-4xl mx-auto">
            <div class="bg-[#E8D6BE] rounded-lg shadow-lg p-8">
                <h3 class="text-2xl font-semibold mb-6 bg-[#E8D6BE]">ç‰¹è‰²å­é¢‘é“å¯¼èˆª</h3>
                <div class="scroll-container">
                    <div class="scroll-item p-4 bg-[#E8D6BE] rounded-lg hover:bg-[#F0E8DD] transition-colors">
                        <h4 class="font-semibold mb-2 text-xl">â­ å…´è¶£çˆ±å¥½</h4>
                        <ul class="space-y-1 text-sm">
                            <li>ğŸ’­ã€Œè¯­è¨€Cosplayã€</li>
                            <li>â™ ï¸ã€Œæ€ç»´æ¸¸æˆã€</li>
                            <li>â›©ã€Œä¸œæ–¹Projectã€</li>
                            <li>ğŸ²ã€Œå¨±ä¹å®¤ã€</li>
                            <li>ğŸ§ã€ŒéŸ³ä¹äº¤æµã€</li>
                        </ul>
                    </div>
                    
                    <div class="scroll-item p-4 bg-[#E8D6BE] rounded-lg hover:bg-[#F0E8DD] transition-colors">
                        <h4 class="font-semibold mb-2 text-xl">ğŸ® æ¸¸æˆå¤©åœ°</h4>
                        <ul class="space-y-1 text-sm">
                            <li>ğŸµã€ŒéŸ³æ¸¸ã€</li>
                            <li>ğŸ•µï¸â€â™‚ï¸ã€Œç¬¬äº”äººæ ¼ã€</li>
                            <li>ğŸï¸ã€ŒMCæœåŠ¡å™¨ã€</li>
                            <li>â™Ÿï¸ã€Œæ˜æ—¥æ–¹èˆŸã€</li>
                            <li>ğŸ’«ã€Œç±³å“ˆæ¸¸ã€</li>
                        </ul>
                    </div>

                    <div class="scroll-item p-4 bg-[#E8D6BE] rounded-lg hover:bg-[#F0E8DD] transition-colors">
                        <h4 class="font-semibold mb-2 text-xl">ğŸ“š å­¦ä¹ æˆé•¿</h4>
                        <ul class="space-y-1 text-sm">
                            <li>ğŸ“šã€Œå­¦ä¹ äº¤æµã€</li>
                            <li>ğŸ¨ã€Œç”»å’–ã€</li>
                            <li>ğŸ–¥ï¸ã€ŒæŠ€æœ¯äº¤æµã€</li>
                        </ul>
                    </div>
                </div>

                <div class="mt-6 text-center">
                    <p class="text-[#3B2B14] italic">
                        è¿˜æœ‰æ›´å¤šç‰¹è‰²é¢‘é“ç­‰ä½ å‘ç°â€¦â€¦<br>
                    </p>
                    <p class="mt-4 text-[#5E1938] font-medium animate-pulse scroll-hint-text">
                        â† å·¦å³æ»‘åŠ¨æŸ¥çœ‹æ›´å¤šé¢‘é“ â†’
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- å…¶ä»–å†…å®¹éƒ¨åˆ† -->
    <section class="h-screen bg-[#73A7E6] text-center text-[#14243B] snap-start pt-24">
        <h2 class="text-4xl font-bold">å…¶ä»–å†…å®¹</h2>
        <p class="text-xl mt-4">è¿™é‡Œæ˜¯å…¶ä»–ç›¸å…³å†…å®¹ã€‚</p>
    </section>
</div>
<button class="fixed bottom-4 right-4 bg-[#3B1426] text-[#F1DDE6] px-4 py-2 rounded" onclick="applyDarkMode()">ğŸŒ™</button>

<script>
    //æ·±è‰²æ¨¡å¼
async function applyDarkMode() {
    // è·å–é¢œè‰²é…ç½®
    const response = await fetch('http://zk.jingbing.icu/json/material_you_palette.json');
    const palettes = await response.json();
    
    // åˆ›å»ºé¢œè‰²æ˜ å°„è¡¨ï¼ˆåŸè‰² -> äº®åº¦ç›¸åçš„é¢œè‰²ï¼‰
    const colorMap = new Map();
    palettes.forEach(palette => {
        palette.forEach(color => {
            // åŸå§‹é¢œè‰²
            const origHex = color.hex.toLowerCase();
            const origRgb = `rgb(${color.rgb.join(',')})`; // æ³¨æ„ï¼šä¿®å¤äº† RGB æ ¼å¼
            const origRgbNoSpace = origRgb.replace(/\s+/g, ''); // å»é™¤ç©ºæ ¼
            
            // è®¡ç®—äº®åº¦ç›¸åçš„é¢œè‰²
            const compHex = getOppositeBrightnessColor(origHex);
            const compRgb = getOppositeBrightnessColor(origRgb);
            
            // å»ºç«‹æ˜ å°„å…³ç³»
            colorMap.set(origHex, compHex);
            colorMap.set(origRgb, compRgb);
            colorMap.set(origRgbNoSpace, compRgb); // æ”¯æŒæ— ç©ºæ ¼çš„ RGB æ ¼å¼
        });
    });

    // æ‰“å°é¢œè‰²æ˜ å°„è¡¨ä»¥è°ƒè¯•
    console.log('é¢œè‰²æ˜ å°„è¡¨:', [...colorMap.entries()]);

    // ç»Ÿè®¡å˜é‡
    let totalElements = 0;
    let replacedElements = 0;

    // æ›¿æ¢æ‰€æœ‰å…ƒç´ çš„ç±»åé¢œè‰²
    document.querySelectorAll('*').forEach(element => {
        totalElements++;
        let hasReplaced = false;
        const newClasses = Array.from(element.classList).map(className => {
            // åŒ¹é… tailwind é¢œè‰²ç±»åæ ¼å¼ï¼ˆå¦‚ bg-[#123456]/50ï¼‰
            const match = className.match(/^(\w+)-\[([#]?[a-fA-F0-9]{3,8}|rgb\(.+?\))\](?:\/(\d+))?/);
            if (!match) return className;

            const [full, prefix, colorValue, opacity] = match;
            const normalizedColor = colorValue.toLowerCase().replace(/\s+/g, ''); // å»é™¤ç©ºæ ¼
            
            // æŸ¥æ‰¾å¯¹åº”çš„äº®åº¦ç›¸åé¢œè‰²
            if (colorMap.has(normalizedColor)) {
                hasReplaced = true;
                const newColor = colorMap.get(normalizedColor);
                return opacity ? `${prefix}-[${newColor}]/${opacity}` : `${prefix}-[${newColor}]`;
            } else {
                // åŠ¨æ€è®¡ç®—äº®åº¦ç›¸åé¢œè‰²
                const oppositeColor = getOppositeBrightnessColor(normalizedColor);
                if (oppositeColor) {
                    hasReplaced = true;
                    return opacity ? `${prefix}-[${oppositeColor}]/${opacity}` : `${prefix}-[${oppositeColor}]`;
                } else {
                    console.warn(`æœªæ‰¾åˆ°åŒ¹é…çš„é¢œè‰²: ${normalizedColor}`, element);
                }
            }
            return className;
        });

        if (hasReplaced) {
            replacedElements++;
            element.className = newClasses.join(' ');
        }
    });

    // è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
    console.log(`æœç´¢åˆ° ${totalElements} ä¸ªå…ƒç´ ï¼Œæ›¿æ¢äº† ${replacedElements} ä¸ªå…ƒç´ çš„ç±»å`);
}

// åŠ¨æ€è®¡ç®—äº®åº¦ç›¸åé¢œè‰²
function getOppositeBrightnessColor(color) {
    if (color.startsWith('#')) {
        // HEX æ ¼å¼
        const rgb = hexToRgb(color);
        const hsl = rgbToHsl(rgb[0], rgb[1], rgb[2]);
        hsl[2] = 100 - hsl[2]; // åè½¬äº®åº¦
        const newRgb = hslToRgb(hsl[0], hsl[1], hsl[2]);
        return rgbToHex(newRgb[0], newRgb[1], newRgb[2]);
    } else if (color.startsWith('rgb')) {
        // RGB æ ¼å¼
        const rgb = color.match(/\d+/g).map(Number);
        const hsl = rgbToHsl(rgb[0], rgb[1], rgb[2]);
        hsl[2] = 100 - hsl[2]; // åè½¬äº®åº¦
        const newRgb = hslToRgb(hsl[0], hsl[1], hsl[2]);
        return `rgb(${newRgb[0]},${newRgb[1]},${newRgb[2]})`;
    }
    return null;
}

// HEX è½¬ RGB
function hexToRgb(hex) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return [r, g, b];
}

// RGB è½¬ HEX
function rgbToHex(r, g, b) {
    return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
}

// RGB è½¬ HSL
function rgbToHsl(r, g, b) {
    r /= 255, g /= 255, b /= 255;
    const max = Math.max(r, g, b), min = Math.min(r, g, b);
    let h, s, l = (max + min) / 2;

    if (max === min) {
        h = s = 0; // ç°åº¦
    } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
    }

    return [h * 360, s * 100, l * 100];
}

// HSL è½¬ RGB
function hslToRgb(h, s, l) {
    h /= 360, s /= 100, l /= 100;
    let r, g, b;

    if (s === 0) {
        r = g = b = l; // ç°åº¦
    } else {
        const hue2rgb = (p, q, t) => {
            if (t < 0) t += 1;
            if (t > 1) t -= 1;
            if (t < 1 / 6) return p + (q - p) * 6 * t;
            if (t < 1 / 2) return q;
            if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
            return p;
        };
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1 / 3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1 / 3);
    }

    return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
}
</script>

<script>
    //åè‰²æ¨¡å¼
async function fs() {
    // è·å–é¢œè‰²é…ç½®
    const response = await fetch('http://zk.jingbing.icu/json/material_you_palette.json');
    const palettes = await response.json();
    
    // åˆ›å»ºé¢œè‰²æ˜ å°„è¡¨ï¼ˆåŸè‰² -> åè‰²ï¼‰
    const colorMap = new Map();
    palettes.forEach(palette => {
        palette.forEach(color => {
            // åŸå§‹é¢œè‰²
            const origHex = color.hex.toLowerCase();
            const origRgb = `rgb(${color.rgb.join(',')})`; // æ³¨æ„ï¼šä¿®å¤äº† RGB æ ¼å¼
            const origRgbNoSpace = origRgb.replace(/\s+/g, ''); // å»é™¤ç©ºæ ¼
            
            // åè‰²é¢œè‰²
            const compHex = color.complementary_hex.toLowerCase();
            const compRgb = `rgb(${color.complementary_rgb.join(',')})`;
            
            // å»ºç«‹æ˜ å°„å…³ç³»
            colorMap.set(origHex, compHex);
            colorMap.set(origRgb, compRgb);
            colorMap.set(origRgbNoSpace, compRgb); // æ”¯æŒæ— ç©ºæ ¼çš„ RGB æ ¼å¼
        });
    });

    // æ‰“å°é¢œè‰²æ˜ å°„è¡¨ä»¥è°ƒè¯•
    console.log('é¢œè‰²æ˜ å°„è¡¨:', [...colorMap.entries()]);

    // ç»Ÿè®¡å˜é‡
    let totalElements = 0;
    let replacedElements = 0;

    // æ›¿æ¢æ‰€æœ‰å…ƒç´ çš„ç±»åé¢œè‰²
    document.querySelectorAll('*').forEach(element => {
        totalElements++;
        let hasReplaced = false;
        const newClasses = Array.from(element.classList).map(className => {
            // åŒ¹é… tailwind é¢œè‰²ç±»åæ ¼å¼ï¼ˆå¦‚ bg-[#123456]/50ï¼‰
            const match = className.match(/^(\w+)-\[([#]?[a-fA-F0-9]{3,8}|rgb\(.+?\))\]/);
            if (!match) return className;

            const [full, prefix, colorValue] = match;
            const normalizedColor = colorValue.toLowerCase().replace(/\s+/g, ''); // å»é™¤ç©ºæ ¼
            
            // æŸ¥æ‰¾å¯¹åº”çš„æ·±è‰²é¢œè‰²
            if (colorMap.has(normalizedColor)) {
                hasReplaced = true;
                return `${prefix}-[${colorMap.get(normalizedColor)}]`;
            } else {
                // åŠ¨æ€è®¡ç®—åè‰²
                const complementaryColor = getComplementaryColor(normalizedColor);
                if (complementaryColor) {
                    hasReplaced = true;
                    return `${prefix}-[${complementaryColor}]`;
                } else {
                    console.warn(`æœªæ‰¾åˆ°åŒ¹é…çš„é¢œè‰²: ${normalizedColor}`, element);
                }
            }
            return className;
        });

        if (hasReplaced) {
            replacedElements++;
            element.className = newClasses.join(' ');
        }
    });

    // è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
    console.log(`æœç´¢åˆ° ${totalElements} ä¸ªå…ƒç´ ï¼Œæ›¿æ¢äº† ${replacedElements} ä¸ªå…ƒç´ çš„ç±»å`);
}

// åŠ¨æ€è®¡ç®—åè‰²
function getComplementaryColor(color) {
    if (color.startsWith('#')) {
        // HEX æ ¼å¼
        const hex = color.slice(1);
        const r = (255 - parseInt(hex.slice(0, 2), 16)).toString(16).padStart(2, '0');
        const g = (255 - parseInt(hex.slice(2, 4), 16)).toString(16).padStart(2, '0');
        const b = (255 - parseInt(hex.slice(4, 6), 16)).toString(16).padStart(2, '0');
        return `#${r}${g}${b}`;
    } else if (color.startsWith('rgb')) {
        // RGB æ ¼å¼
        const rgb = color.match(/\d+/g).map(Number);
        const r = 255 - rgb[0];
        const g = 255 - rgb[1];
        const b = 255 - rgb[2];
        return `rgb(${r},${g},${b})`;
    }
    return null;
}

</script>

{% endblock %}